// ==UserScript==
// @name         TEMUHOOK
// @namespace    SAN
// @version      2.12
// @description  TEMUHOOK 提交
// @author       XIAOSAN
// @match        *://seller.kuajingmaihuo.com/*
// @match        *://agentseller.temu.com/*
// @homepageURL  https://www.baidu.com
// @updateURL    https://raw.githubusercontent.com/TristanBlack/TEMUHOOK/refs/heads/main/dist/main.min.js
// @downloadURL  https://raw.githubusercontent.com/TristanBlack/TEMUHOOK/refs/heads/main/dist/main.min.js
// @require      https://cdn.jsdelivr.net/npm/vue@3.5.13/dist/vue.global.min.js
// @require      data:application/javascript,unsafeWindow.Vue%3DVue%2Cthis.Vue%3DVue%3B
// @require      https://cdn.jsdelivr.net/npm/element-plus@2.9.5/dist/index.full.min.js
// @resource     ELEMENT_CSS https://cdn.jsdelivr.net/npm/element-plus@2.9.5/dist/index.min.css
// @grant        unsafeWindow
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// ==/UserScript==
!function(){"use strict";const e=GM_getResourceText("ELEMENT_CSS");GM_addStyle(e),GM_addStyle('\n        #vueApp{\n            position: fixed;\n            top: 50%;\n            right: 30px;\n            z-index: 99999;\n        }\n        #vueApp .fix-tabs{\n            display: flex;\n            flex-direction: column-reverse;\n        }\n        .el-tag + .el-tag {\n          margin-left: 10px;\n        }\n        #vueApp .logBox{\n            margin-bottom: 20px;\n            max-height: 300px;\n            overflow: auto;\n        }\n        #vueApp .process-progress{\n            display: flex;\n            flex-wrap: wrap;\n            gap: 10px;\n            margin-top: 10px;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .is-blockPopUps [data-testid="beast-core-modal-mask"],\n        .is-blockPopUps [data-testid="beast-core-modal"]{\n            display: none !important;\n        }\n        .el-overlay.is-message-box {\n          z-index: 999999 !important; /* 例如 3000 */\n        }\n    ');let t=document.createElement("div");t.innerHTML='\n        <div id="vueApp">\n            <el-button type="info" @click="openPanl">TEMUHOOK</el-button>\n\n            <el-drawer v-model="settingDrawer" title="设置面板" :with-header="false" >\n\n                <el-tabs type="border-card" class="fix-tabs" v-model="currentTab">\n\x3c!--                     <el-tab-pane label="全局">\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-form-item label="隐藏弹窗">\n                                <el-switch v-model="configSetting.blockPopUps" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="页面大小">\n                                <el-input v-model="configSetting.pageSize" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="起始页码">\n                                <el-input v-model="configSetting.pageNum" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="自动翻页">\n                                <el-switch v-model="configSetting.autoPage" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="等待时间">\n                                <el-input v-model="configSetting.waitSeconds" :disabled="fetchState" />\n                            </el-form-item>\n                        </el-form>\n                    </el-tab-pane> --\x3e\n                    <el-tab-pane label="上新生命周期" name="SMZQ">\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-table :data="configSetting.abandonPriceRule" style="width: 100%">\n                                <el-table-column label="价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.price" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="最高价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.maxPrice" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="SMZQ_abandonPriceRuleDelete(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="SMZQ_abandonPriceRuleAdd" :disabled="configSetting.abandonPriceRule.length > 0">添加金额规则</el-button>\n                            </div>\n                            <el-divider>核价申报类目</el-divider>\n                             <el-form-item label="选择类目" required>\n                                <el-checkbox-group v-model="configSetting.abandonCategories" @change="handleAbandonCategoriesChange">\n                                    <el-checkbox label="A">A：常规T恤</el-checkbox>\n                                    <el-checkbox label="B">B：大码T恤</el-checkbox>\n                                    <el-checkbox label="C">C：常规卫衣</el-checkbox>\n                                    <el-checkbox label="D">D：大码卫衣</el-checkbox>\n                                    \n                                    <el-checkbox label="ALL">全部</el-checkbox>\n                                </el-checkbox-group>\n                            </el-form-item>\n                        </el-form>\n                    </el-tab-pane>\n                    <el-tab-pane label="活动申报" name="HDSB">\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-divider>价格类目关联规则</el-divider>\n                            <el-alert v-if="configSetting.activityPriceCategoryRules.length === 0" \n                                title="警告：必须配置价格类目规则才能进行活动申报！请添加至少一条价格类目关联规则。" \n                                type="warning" \n                                show-icon \n                                :closable="false" \n                                style="margin-bottom: 10px;">\n                            </el-alert>\n                            <el-table :data="configSetting.activityPriceCategoryRules" style="width: 100%">\n                                <el-table-column label="最低价格(分)" width="150">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.price" :min="2000" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="最高价格(分)" width="150">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.maxPrice" :min="2000" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="关联类目">\n                                    <template #default="scope">\n                                        <el-radio-group v-model="scope.row.category">\n                                            <el-radio label="A">A：常规T恤</el-radio>\n                                            <el-radio label="B">B：大码T恤</el-radio>\n                                            <el-radio label="C">C：常规卫衣</el-radio>\n                                            <el-radio label="D">D：大码卫衣</el-radio>\n                                        </el-radio-group>\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="操作" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_priceCategoryRuleDelete(scope.$index, scope.row)" :disabled="fetchState">\n                                        删除\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_priceCategoryRuleAdd" :disabled="fetchState">添加价格类目规则</el-button>\n                            </div>\n                        <el-divider>过滤字符</el-divider>\n                            <el-table :data="configSetting.activityFilerStrRule" style="width: 100%">\n                                <el-table-column label="SKU属性集">\n                                    <template #default="scope">\n                                        <el-input v-model="scope.row.str"  :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_activityFilerStrDel(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_activityFilerStrAdd">添加字符匹配过滤</el-button>\n                            </div>\n                        <el-divider>活动库存</el-divider>\n                            <el-table :data="configSetting.activityTargetActivityStock" style="width: 100%">\n                                <el-table-column label="库存数量">\n                                    <template #default="scope">\n                                        <el-input v-model="scope.row.num"  :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_activityTargetActivityStockDel(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_activityTargetActivityStockAdd" :disabled="configSetting.activityTargetActivityStock.length > 0">添加数量</el-button>\n                            </div>\n\n                        </el-form>\n                    </el-tab-pane>\n                </el-tabs>\n                <div style="margin-top: 30px;" v-if="siteList.length">\n                  <el-divider content-position="left">选择站点 <el-button type="text" :disabled="siteList.length == 0" @click="showSelectSite">更改</el-button></el-divider>\n                  \x3c!--<template v-if="siteList.length"><el-tag size="small" v-for="val in configSetting.checkedSites" :key="val">{{siteLabel(val) }}</el-tag></template>--\x3e\n                  <el-tag size="small" v-if="configSetting.checkedSites" >{{siteLabel(configSetting.checkedSites) }}</el-tag>\n                </div>\n                <div style="margin-top: 30px;" v-if="malInfoList.length">\n                <el-divider  content-position="left">选择店铺</el-divider>\n                <el-radio-group v-model="configSetting.mallId">\n                        <el-radio v-for="item in malInfoList" :key="item.mallId" :value="item.mallId" :disabled="fetchState">{{item.mallName}}</el-radio>\n                    </el-radio-group>\n                </div>\n\x3c!--                 <div style="margin-top: 30px;">\n                    <el-button type="info" @click="dialogLogVisible = true">日志</el-button>\n                <div> --\x3e\n\n\n                <div style="margin-top: 30px;" v-if="getUserInfoState && configSetting.mallId">\n                  <el-button v-if="currentTab == \'SMZQ\'" :loading="fetchState" type="primary" @click="handleClick(\'上新生命周期\')">上新生命周期</el-button>\n\n\x3c!--                       <el-button type="info" @click="handleClick(\'批量签署JIT规则\')">批量签署JIT规则</el-button> --\x3e\n\n                    <el-button v-if="currentTab == \'HDSB\'" :loading="fetchState" type="primary" @click="handleClick(\'批量活动申报\')">批量活动申报</el-button>\n                </div>\n\n            </el-drawer>\n\n            <el-dialog v-model="dialogLogVisible" :title="\'日志: \' + clickState" destroy-on-close>\n                <template v-if="clickState == \'上新生命周期\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                    <template v-if="logInfo.totals > 0">\n                        <div><el-progress :percentage="Number((logInfo.index / logInfo.totals * 100).toFixed(2))" /></div>\n                        <div class="process-progress"><span>任务进度: {{logInfo.text}}</span><span>{{logInfo.index}}/{{logInfo.totals}}</span></div>\n                    </template>\n                </template>\n                <template v-if="clickState == \'批量签署JIT规则\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                </template>\n                <template v-if="clickState == \'批量活动申报\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                </template>\n            </el-dialog>\n\n            <el-dialog v-model="dialogSiteVisible" title="选择地区" destroy-on-close>\n              \x3c!--<el-checkbox-group v-model="configSetting.checkedSites" >\n                  <el-checkbox v-for="val in siteList" :label="val.siteId" :key="val.siteId">{{val.siteName}}</el-checkbox>\n              </el-checkbox-group>--\x3e\n                <el-radio-group v-model="configSetting.checkedSites" @change="dialogSiteVisible = false">\n                  <el-radio v-for="val in siteList" :label="val.siteId" :key="val.siteId">{{val.siteName}}</el-radio>\n              </el-radio-group>\n            </el-dialog>\n        </div>\n    ',console.log(document.cookie),document.body.append(t);const i={data:()=>({settingDrawer:!1,currentTab:"SMZQ",dialogLogVisible:!1,dialogSiteVisible:!1,selectedActivity:"",siteList:[{siteId:100,siteName:"美国站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:101,siteName:"加拿大站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:102,siteName:"英国站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:103,siteName:"澳大利亚站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:104,siteName:"新西兰站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:105,siteName:"德国站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:106,siteName:"法国站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:107,siteName:"意大利站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:108,siteName:"荷兰站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:109,siteName:"西班牙站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:110,siteName:"墨西哥站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:111,siteName:"葡萄牙站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:112,siteName:"波兰站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:113,siteName:"瑞典站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:114,siteName:"瑞士站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:115,siteName:"希腊",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:116,siteName:"爱尔兰",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:117,siteName:"塞浦路斯",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:118,siteName:"日本站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:119,siteName:"韩国站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:120,siteName:"沙特站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:121,siteName:"新加坡站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:122,siteName:"阿联酋站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:123,siteName:"科威特站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:124,siteName:"挪威站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:125,siteName:"智利站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:126,siteName:"马来西亚站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:127,siteName:"菲律宾站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:128,siteName:"中国台湾站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:129,siteName:"泰国站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:130,siteName:"卡塔尔站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:131,siteName:"约旦站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:132,siteName:"巴西站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:133,siteName:"阿曼站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:134,siteName:"巴林站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:135,siteName:"以色列站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:136,siteName:"南非站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:141,siteName:"保加利亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:137,siteName:"捷克站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:138,siteName:"匈牙利站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:139,siteName:"丹麦站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:140,siteName:"罗马尼亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:142,siteName:"比利时站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:143,siteName:"奥地利站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:144,siteName:"芬兰站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:145,siteName:"斯洛伐克站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:146,siteName:"克罗地亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:147,siteName:"斯洛文尼亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:148,siteName:"立陶宛站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:149,siteName:"爱沙尼亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:150,siteName:"拉脱维亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:151,siteName:"马耳他站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:152,siteName:"卢森堡站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:153,siteName:"塞尔维亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:154,siteName:"摩尔多瓦",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:155,siteName:"黑山",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:156,siteName:"冰岛",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:157,siteName:"安道尔",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:158,siteName:"波黑",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:159,siteName:"阿尔巴尼亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:160,siteName:"北马其顿-已废弃",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:162,siteName:"哈萨克斯坦",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:163,siteName:"秘鲁",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:164,siteName:"哥伦比亚",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:165,siteName:"格鲁吉亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:166,siteName:"亚美尼亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:167,siteName:"阿塞拜疆",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:168,siteName:"乌克兰",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:169,siteName:"乌拉圭",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:161,siteName:"科索沃",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:170,siteName:"毛里求斯",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:171,siteName:"摩洛哥",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:172,siteName:"多米尼加",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:173,siteName:"哥斯达黎加",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:174,siteName:"土耳其",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:175,siteName:"阿尔及利亚站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:176,siteName:"巴拿马站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:177,siteName:"肯尼亚站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:178,siteName:"厄瓜多尔站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:179,siteName:"特立尼达和多巴哥站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:180,siteName:"危地马拉站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:181,siteName:"乌兹别克斯坦站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:182,siteName:"洪都拉斯站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:183,siteName:"萨尔瓦多站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:184,siteName:"巴基斯坦站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:185,siteName:"斯里兰卡站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:186,siteName:"蒙古站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:187,siteName:"越南站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:188,siteName:"文莱站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:189,siteName:"阿根廷站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:190,siteName:"尼日利亚站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:191,siteName:"柬埔寨站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:192,siteName:"北马其顿",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:193,siteName:"孟加拉站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:194,siteName:"吉尔吉斯斯坦站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:196,siteName:"马尔代夫站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:197,siteName:"列支敦士登站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:198,siteName:"加纳站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:199,siteName:"埃及站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:200,siteName:"巴拉圭站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1}],configSetting:Object.assign({Cookie:"",blockPopUps:!1,pageSize:100,pageNum:1,autoPage:!0,waitSeconds:5,abandonPriceRule:[],activityPriceRule:[],activityFilerStrRule:[],activityTargetActivityStock:[],activityCategory:"",abandonCategories:[],activityPriceCategoryRules:[],token:null,checkedSites:null},GM_getValue("configSetting"),{Cookie:document.cookie}),getUserInfoState:!1,clickState:"",fetchState:!1,malInfoList:[],activityList:[],currentActivity:25022164983552,logList:[],logInfo:{index:0,totals:0,text:""}}),mounted(){this.$nextTick(async()=>{await this.getUserInfo(),this.getSiteList(),this.HDSB_getActivityList();const e=unsafeWindow.document.body;this.configSetting.blockPopUps&&e.classList.add("is-blockPopUps"),this.configSetting})},methods:{openPanl:async function(){this.settingDrawer=!0},login(){this.$prompt("输入令牌","提示",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"login-message-box",inputPattern:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,inputErrorMessage:"输入令牌格式不正确"}).then(({value:e})=>{GM_xmlhttpRequest({url:"http://182.254.136.122:8765/login",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({username:e}),onload:t=>{200==t.status?(this.configSetting.token=e,this.$message({type:"success",message:"你的令牌是: "+e}),this.settingDrawer=!0):(this.$message({type:"error",message:"没有此令牌"}),setTimeout(()=>{this.login()},1e3))},onerror:e=>{console.error("Error:",e)}})}).catch(()=>{this.$message({type:"error",message:"取消输入"})})},checkToken:async function(){return new Promise((e,t)=>{if(!this.configSetting.token)return this.login(),void e(!1);GM_xmlhttpRequest({url:"http://182.254.136.122:8765/protected",method:"GET",headers:{"X-Username":this.configSetting.token},onload:t=>{200===t.status?e(!0):(this.configSetting.token=null,this.login(),this.$message({type:"error",message:"失效的令牌"}),e(!1))},onerror:t=>{console.error("Error:",t),e(!1)}})})},handleAbandonCategoriesChange(e){const t=e.indexOf("ALL");this.configSetting.abandonCategories=t>-1?["A","B","C","D","ALL"]:e.filter(e=>"ALL"!==e)},HDSB_getMatch:function(e){const t=this.configSetting,i=new URLSearchParams(window.location.search);let a=i.get("type");const n={activityThematicId:1*i.get("thematicId"),activityType:1*a,addSite:!0,rowCount:50};return e&&(n.searchScrollContext=e),fetch("https://agentseller.temu.com/api/kiana/gamblers/marketing/enroll/semi/scroll/match",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(n)}).then(e=>e.json())},HDSB_submit:async function(e){const t=this.configSetting,i=new URLSearchParams(window.location.search);let a=i.get("type");const n={activityThematicId:i.get("thematicId"),activityType:a,productList:e};return fetch("https://agentseller.temu.com/api/kiana/gamblers/marketing/enroll/semi/submit",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(n)}).then(e=>e.json())},HDSB_getActivityList:function(){const e=this.configSetting;fetch("https://seller.kuajingmaihuo.com/marvel-mms/cn/api/kiana/gambit/marketing/enroll/activity/list",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie,mallid:e.mallId},body:JSON.stringify({needCanEnrollCnt:!0,needSessionItem:!0})}).then(e=>e.json()).then(e=>{if(e.success){let t=[];e.result.activityList.forEach(e=>{t=t.concat(e.thematicList)}),this.activityList=t}else console.warn(`获取活动列表失败: ${e.errorMsg}`)}).catch(e=>{console.error("获取活动列表失败: ",e)})},waitSeconds:function(e){return new Promise(t=>setTimeout(t,1e3*e))},getUserInfo:function(){switch(window.location.host){case"seller.kuajingmaihuo.com":default:this.getUserInfo_seller_kuajingmaihuo_com();break;case"agentseller.temu.com":this.getUserInfo_agentseller_temu_com()}},getUserInfo_seller_kuajingmaihuo_com:async function(){const e=this.configSetting;fetch("https://seller.kuajingmaihuo.com/bg/quiet/api/mms/userInfo",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie},body:JSON.stringify({})}).then(e=>e.json()).then(e=>{e.success?(this.malInfoList=e.result.companyList[0].malInfoList,this.configSetting.mallId=this.malInfoList[0].mallId,this.getUserInfoState=!0):console.warn(`获取用户信息失败: ${e.errorMsg}`)}).catch(e=>{console.error("获取用户信息失败: ",e)})},getUserInfo_agentseller_temu_com:async function(){const e=this.configSetting;fetch("https://agentseller.temu.com/api/seller/auth/userInfo",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie},body:JSON.stringify({})}).then(e=>e.json()).then(e=>{e.success?(this.malInfoList=e.result.mallList,this.configSetting.mallId=this.malInfoList[0].mallId,this.getUserInfoState=!0):console.warn(`获取用户信息失败: ${e.errorMsg}`)}).catch(e=>{console.error("获取用户信息失败: ",e)})},getSiteList:function(){const e=this.configSetting;fetch("https://seller.kuajingmaihuo.com/bg-visage-mms/config/common/site/query",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie,mallid:e.mallId},body:JSON.stringify({})}).then(e=>e.json()).then(e=>{e.success?this.siteList=e.result.siteBaseList:console.warn(`获取站点列表失败: ${e.errorMsg}`)}).catch(e=>{console.error("获取站点列表失败: ",e)})},showSelectSite:function(){this.dialogSiteVisible=!0},siteLabel(e){return this.siteList.find(t=>t.siteId==e).siteName},SMZQ_abandonPriceRuleAdd:function(){this.configSetting.abandonPriceRule.push({price:2e3,maxPrice:4e3})},SMZQ_abandonPriceRuleDelete:function(e,t){this.configSetting.abandonPriceRule.splice(e,1)},SMZQ_AbandonPriceRule:function(e){const t=this.configSetting.abandonPriceRule[0].price,i=this.configSetting.abandonPriceRule[0].maxPrice;return console.log(t,i),e<t?3:e>i?2:1},SMZQ_AbandonPriceSet:function(e){this.configSetting.abandonPriceRule[0].price;const t=this.configSetting.abandonPriceRule[0].maxPrice;return e>t?t:e},SMZQ_searchForChainSupplier:function(e,t){const i=this.configSetting,a={pageSize:t=void 0===t?i.pageSize:t,pageNum:e,secondarySelectStatusList:[7],supplierTodoTypeList:[1]};return fetch("https://agentseller.temu.com/api/kiana/mms/robin/searchForSemiSupplier",{method:"POST",headers:{"Content-Type":"application/json",Cookie:i.Cookie,mallid:i.mallId},body:JSON.stringify(a)}).then(e=>e.json())},SMZQ_rejectRemark:function(e){const t=this.configSetting,i={orderIds:e};return fetch("https://agentseller.temu.com/api/kiana/magnus/mms/price/bargain-no-bom/batch/info/query",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(i)}).then(e=>e.json())},SMZQ_reviewNoBom:function(e){const t=this.configSetting,i={priceOrderId:e};return fetch("https://seller.kuajingmaihuo.com/gmp/bg/magneto/api/price-review-order/no-bom/review",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(i)}).then(e=>e.json())},SMZQ_combineData:function(e){},SMZQ_bargainNoBom:function(e){const t=this.configSetting;return fetch("https://agentseller.temu.com/api/kiana/magnus/mms/price/bargain-no-bom/batch",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(e)}).then(e=>e.json())},HDSB_match_procution_data:function(e){const t=this.configSetting,i=t.activityPriceCategoryRules||[],a=t.activityFilerStrRule,n=t.activityTargetActivityStock,s=t.checkedSites;t.activityCategory;console.log(n);const o=this;o.fetchState=!0,o.logList=[];let l=e,c=[];if(0===i.length)return o.logList.push({text:"错误：未配置价格类目规则，无法进行活动申报！请先在设置中添加价格类目关联规则。"}),o.fetchState=!1,void ElMessage.error("未配置价格类目规则，无法进行活动申报！请先添加价格类目关联规则。");o.logList.push({text:`使用价格类目关联规则，共${i.length}条规则`});const r=e=>{for(let t of i)if(t.category){if(new RegExp(`^${t.category}.*`).test(e))return o.logList.push({text:`价格规则匹配成功：extCode '${e}' 使用价格规则 ${t.price}-${t.maxPrice}分`}),{price:t.price,maxPrice:t.maxPrice}}return o.logList.push({text:`价格规则匹配失败：extCode '${e}' 未找到匹配规则，该商品将被排除`}),null};if(a.length){o.logList.push({text:"排除掉所有SKU属性集包含的..."});let e=[],t=0;for(let i of l){i.activitySiteInfoList.some(e=>e.skcList.some(e=>e.skuList.some(e=>Object.values(e.properties).some(e=>!!this.HDSB_activityFilterSKU(e)&&(o.logList.push({text:`排除：sku属性集${e}中包含设置的字符`}),!0)))))?t++:e.push(i)}o.logList.push({text:`统计：共${l.length} 条数据, 通过SKU属性集排除了 ${t} 条数据`}),l=e}if(s){o.logList.push({text:`筛选站点:${this.siteLabel(s)}的数据`});let e=l.filter(e=>e.sites.some(e=>e.siteId==s));l=e,o.logList.push({text:`站点:${this.siteLabel(s)}的数据,共 ${l.length} 条数据`})}return c=l.map(e=>({productId:e.productId,activityStock:1*(n.length>0?n[0].num:e.targetActivityStock),siteInfoList:e.activitySiteInfoList.map(t=>({siteId:t.siteId,skcList:t.skcList.filter(e=>{if(e.skuList&&e.skuList.length>0){const t=e.skuList[0],i=r(t.extCode||"");return null!==i&&e.suggestActivityPrice>=i.price}return!1}).map(t=>{let i={price:0,maxPrice:999999};if(t.skuList&&t.skuList.length>0){const e=t.skuList[0];i=r(e.extCode||"")}let a=t.suggestActivityPrice>i.maxPrice?i.maxPrice:t.suggestActivityPrice;return o.logList.push({text:`${e.productId}---extCode: ${t.skuList[0]?.extCode||"N/A"}, 价格规则: ${i.price}-${i.maxPrice}, 建议价格: ${t.suggestActivityPrice}=>${a}`}),{skcId:t.skcId,skuList:t.skuList.map(e=>({skuId:e.skuId})),activityPrice:a}})})).filter(e=>e.skcList.length>0),sessionIds:e.suggestEnrollSessionIdList})).filter(e=>e.siteInfoList.length>0),c},HDSB_execute:async function(){const e=this.configSetting,t=this.waitSeconds,i=this;i.fetchState=!0,i.logList=[];let a=!0,n=null,s=!1;if(!e.activityPriceCategoryRules||0===e.activityPriceCategoryRules.length)return this.$message({type:"error",message:"请至少选择一个活动申报类目",duration:5e3}),this.logList.push({text:"错误: 请至少选择一个活动申报类目"}),void(this.fetchState=!1);for(const t of e.activityPriceCategoryRules){let e=2e3;if("C"!==t.category&&"D"!==t.category||(e=8e3),t.price<e||t.maxPrice<e||t.price>t.maxPrice){s=!0,this.logList.push({text:`错误: 类目${t.category}的价格不能低于${e}分`});break}}if(s)return this.$message({type:"error",message:"金额设置错误！",duration:5e3}),this.logList.push({text:"错误: 金额设置错误！"}),void(this.fetchState=!1);do{let s=await this.HDSB_getMatch(n);if(s.success){let o=s.result.matchList;a=s.result.hasMore,n=a?s.result.searchScrollContext:null,i.logList.push({text:`服务器返回数据成功, 共${o.length}条数据`});let l=this.HDSB_match_procution_data(o);if(l.length){i.logList.push({text:`等待${e.waitSeconds}秒后提交`}),await t(e.waitSeconds),(await this.HDSB_submit(l)).success?i.logList.push({text:`活动申报成功,该页总归申报${l.length}个`}):(i.logList.push({text:"活动申报失败"}),console.warn(`活动申报失败: ${data.errorMsg}`))}else i.logList.push({text:"该页没有符合条件的数据"})}else i.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${data.errorMsg}`);i.logList.push({text:`等待${e.waitSeconds}秒请求....`}),await t(e.waitSeconds)}while(a);i.fetchState=!1,i.logList.push({text:"全部处理完成"})},SMZQ_execute:async function(){const e=this;e.fetchState=!0,e.logList=[];let t=!1;const i=this.configSetting;if(!i.abandonCategories||0===i.abandonCategories.length)return this.$message({type:"error",message:"请至少选择一个核价申报类目",duration:5e3}),this.logList.push({text:"错误: 请至少选择一个核价申报类目"}),void(this.fetchState=!1);for(const e of i.abandonPriceRule)if(e.price<2e3||e.maxPrice<2e3||e.price>e.maxPrice){t=!0;break}if(t)return e.logList.push({text:"价格设置错误"}),this.$message({type:"error",message:"价格必须大于3500且最高价格必须大于价格",duration:5e3}),void(this.fetchState=!1);const a=this.waitSeconds,n=this.SMZQ_searchForChainSupplier,s=this.SMZQ_rejectRemark,o=this.SMZQ_AbandonPriceRule,l=this.SMZQ_AbandonPriceSet,c=(this.SMZQ_reviewNoBom,this.SMZQ_bargainNoBom),r=this.configSetting.checkedSites;e.logInfo={index:0,totals:3,text:"正在拉取商品数据"};let m=0,d=i.pageNum;i.autoPage&&await n(1,1).then(t=>{console.log("getDataList(1,1): ",t),t.success?m=Math.ceil(t.result.total/i.pageSize):(e.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${t.errorMsg}`))}).catch(e=>{console.error("获取商品信息失败: ",e)});let g=[],h=[],u=[];do{e.logList.push({text:`等待${i.waitSeconds}秒请求: 发送请求第${d}页`}),await a(i.waitSeconds),g.push(n(d)),d++,d>m&&e.logList.push({text:"请求商品列表结束,等待服务器返回数据"})}while(d<=m);Promise.all(g).then(async t=>{let n=[];t.forEach(e=>{e.success&&n.push(...e.result.dataList)}),e.logList.push({text:`服务器返回数据成功, 共${n.length}条数据`});let o=[];for(let t=0;t<n.length;t++){const a=n[t];for(let t=0;t<a.skcList.length;t++){const n=a.skcList[t];e.logList.push({text:`正在处理SKC: ${n.skcId}`});for(let t=0;t<n.supplierPriceReviewInfoList.length;t++){const a=n.supplierPriceReviewInfoList[t];if(0==a.status){e.logList.push({text:"跳过: 价格申报中"});continue}if(r&&!a.siteList.some(e=>e.siteId==r)){e.logList.push({text:`跳过: 不属于 ${this.siteLabel(r)} 站点`});continue}let s=!1;for(let e=0;e<n.skuList.length;e++){const t=n.skuList[e];if(i.abandonCategories.includes("ALL")){s=!0;break}for(const e of i.abandonCategories){if(new RegExp(`^${e}.*`).test(t.extCode)){s=!0;break}}if(s)break}s?o.push(a.priceOrderId):e.logList.push({text:"跳过: SKU不满足核价申报类目要求"})}}}let l=this.sliceArrayInChunks(o,700);for(let[t,n]of l.entries())e.logList.push({text:`等待${i.waitSeconds}秒请求第${t+1}片: 价格推荐信息=>700条一片`}),await a(i.waitSeconds),h.push(s(n));return e.logInfo={index:1,totals:3,text:"正在处理上新审核价格"},Promise.all(h)}).then(async t=>{e.logList.push({text:"请求商品列表结束,等待服务器返回数据"});let n=[];t.forEach(e=>{console.log(e),e.success&&n.push(...e.result.priceReviewItemList)}),e.logList.push({text:`服务器返回数据成功, 共${n.length}条数据`}),e.logList.push({text:"等待: 组合提交数据"});let s=n.map(e=>{let t=o(e.suggestSupplyPrice);return 3==t?{priceOrderId:e.id,supplierResult:t,items:e.skuInfoList.map(e=>({productSkuId:e.productSkuId}))}:{priceOrderId:e.id,supplierResult:t,items:e.skuInfoList.map(e=>({productSkuId:e.productSkuId,price:l(e.suggestSupplyPrice)}))}});e.logList.push({text:`数据组合完毕: 共${s.length}条数据`});let r=this.sliceArrayInChunks(s,200);for(let[t,n]of r.entries())e.logList.push({text:`等待${i.waitSeconds}秒请求第${t+1}片: 数据提交=>200条一片`}),await a(i.waitSeconds),u.push(c({itemRequests:n}));return e.logInfo={index:2,totals:3,text:"正在处理最后数据提交"},Promise.all(u)}).then(async t=>{t.forEach((t,i)=>{t.success?e.logList.push({text:`返回=>第${i+1}片: 成功`}):e.logList.push({text:`返回=>第${i+1}片: 失败`})}),e.logInfo={index:3,totals:3,text:"任务全部完成"}}).then(()=>{e.logList.push({text:"所有任务已完成"}),e.fetchState=!1}).catch(e=>{console.error("服务器返回数据失败: ",e)})},SPLB_pageQuery:function(e,t){const i=this.configSetting,a={pageSize:t=void 0===t?i.pageSize:t,page:e,skcJitStatus:3,skcSiteStatus:0};return fetch("https://seller.kuajingmaihuo.com/bg-visage-mms/product/skc/pageQuery",{method:"POST",headers:{"Content-Type":"application/json",Cookie:i.Cookie,mallid:i.mallId},body:JSON.stringify(a)}).then(e=>e.json())},SPLB_signJIT:function(e){const t=this.configSetting,i={skcList:e};return fetch("https://seller.kuajingmaihuo.com/bg-visage-mms/product/agreement/batch/sign",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(i)}).then(e=>e.json())},SPLB_execute:async function(){const e=this.configSetting,t=this.waitSeconds,i=this.SPLB_pageQuery,a=this.SPLB_signJIT,n=this;n.fetchState=!0,n.logList=[];let s=0,o=e.pageNum;e.autoPage&&await i(1,1).then(t=>{console.log("pageQuery(1,1): ",t),t.success?s=Math.ceil(t.result.total/e.pageSize):(n.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${t.errorMsg}`))}).catch(e=>{console.error("获取商品信息失败: ",e)});let l=[];do{n.logList.push({text:`等待${e.waitSeconds}秒请求: 发送请求第${o}页`}),await t(e.waitSeconds),l.push(i(o)),o++,o>s&&n.logList.push({text:"请求商品列表结束,等待服务器返回数据"})}while(o<=s);Promise.all(l).then(async i=>{let s=[];i.forEach(e=>{e.success&&s.push(...e.result.pageItems)}),n.logList.push({text:`服务器返回数据成功, 共${s.length}条数据`}),console.log(s);let o=[];for(let e=0;e<s.length;e++){const t=s[e];o.push({productId:t.productId,productSkcId:t.productSkcId})}let l=[];for(let e=0;e<o.length;e+=20)l.push(o.slice(e,e+20));if(l.length)for(let i=0;i<l.length;i++){const s=l[i];n.logList.push({text:`等待${e.waitSeconds}秒请求: 第${i+1}次签署,签署${s.length}个`}),await t(e.waitSeconds),await a(s).then(e=>{if(e.success){if(n.logList.push({text:`签署成功: ${e.result.successNum}`}),n.logList.push({text:`签署失败: ${e.result.failedNum}`}),e.result.failedDetailList.length)for(let t=0;t<e.result.failedDetailList.length;t++){const i=e.result.failedDetailList[t];n.logList.push({text:`Skc: ${i.productSkcId}, ${i.errorMsg}`})}}else console.warn(`签署失败: ${e.errorMsg}`)}).catch(e=>{console.error("签署失败: ",e)})}else n.logList.push({text:"需要签署为空"});n.fetchState=!1}).catch(e=>{console.error("服务器返回数据失败: ",e)})},HDSB_activityPirceAdd:function(){this.configSetting.activityPriceRule.push({price:2e3,maxPirce:4e3})},HDSB_activityTargetActivityStockAdd:function(){this.configSetting.activityTargetActivityStock.push({num:""})},HDSB_activityFilerStrAdd:function(){this.configSetting.activityFilerStrRule.push({str:""})},HDSB_activityTargetActivityStockDel:function(e){this.configSetting.activityTargetActivityStock.splice(e,1)},HDSB_activityFilerStrDel:function(e){this.configSetting.activityFilerStrRule.splice(e,1)},HDSB_activityPirceDelete:function(e,t){this.configSetting.activityPriceRule.splice(e,1)},HDSB_priceCategoryRuleAdd:function(){this.configSetting.activityPriceCategoryRules.push({price:2e3,maxPrice:5e3,category:""})},HDSB_priceCategoryRuleDelete:function(e,t){this.configSetting.activityPriceCategoryRules.splice(e,1)},HDSB_activityFilterSKU:function(e){return this.configSetting.activityFilerStrRule.some(t=>new RegExp(t.str,"i").test(e))},handleClick:async function(e){"上新生命周期"==e&&this.SMZQ_execute(),"批量签署JIT规则"==e&&this.SPLB_execute(),"批量活动申报"==e&&this.HDSB_execute(),this.clickState=e,this.dialogLogVisible=!0},sliceArrayInChunks:function(e,t){const i=[];let a=0;for(;a<e.length;)i.push(e.slice(a,a+t)),a+=t;return i}},watch:{configSetting:{handler(e,t){this.$nextTick(()=>{unsafeWindow.document.body.classList.toggle("is-blockPopUps",e.blockPopUps),GM_setValue("configSetting",e)})},deep:!0}}},a=Vue.createApp(i);a.use(ElementPlus),a.mount("#vueApp")}();